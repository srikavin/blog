<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><title>aes-ctr - Tags - srikavin.me</title><link href="/assets/favicon.png" rel="icon"><link href="/bundle.css" rel="stylesheet"><script src="https://www.googletagmanager.com/gtag/js?id=G-X8ZVFPQ0CK" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-X8ZVFPQ0CK');</script></head><body><script>const theme = localStorage.getItem("theme");
    document.body.className = theme || (window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");</script><nav><div class="nav-left"><span><a href="https://srikavin.me" class="name">Srikavin Ramkumar</a> </span><span><a href="/posts" class="nav-link">Posts</a> </span><span><a href="/tags" class="nav-link">Tags</a></span></div><div class="nav-right"><a href="https://github.com/srikavin"><img alt="Github" src="/assets/gh-logo.png" height="24px" width="24px"></a></div></nav><section class="section"><div class="container"><div class="page-container tags-content"><h1>Posts tagged with <span class="minimal tag">aes-ctr</span></h1><div class="blog-preview-list"><div class="blog-preview"><div class="blog-header"><h1 class="title"><a href="https://blog.srikavin.me/posts/picoctf-2018-electric/">picoCTF 2018 - eleCTRic</a></h1><div class="subtitle"><span>Posted on <span class="date" title="Created: 2018-10-13T02:36:19.176Z&#10;Updated: 2020-12-27">October 13, 2018* </span>in ctf-writeups</span></div><div class="tags"><a href="https:&#x2F;&#x2F;blog.srikavin.me&#x2F;tags&#x2F;picoctf18&#x2F;"><span class="minimal tag interactive">picoctf18</span></a> <a href="https:&#x2F;&#x2F;blog.srikavin.me&#x2F;tags&#x2F;cryptography&#x2F;"><span class="minimal tag interactive">cryptography</span></a> <a href="https:&#x2F;&#x2F;blog.srikavin.me&#x2F;tags&#x2F;aes-ctr&#x2F;"><span class="minimal tag interactive">aes-ctr</span></a> <a href="https:&#x2F;&#x2F;blog.srikavin.me&#x2F;tags&#x2F;aes&#x2F;"><span class="minimal tag interactive">aes</span></a></div></div><div class="blog-content"><h1 id="problem">Problem</h1><blockquote><p>&quot;You came across a custom server that Dr Xernon's company eleCTRic Ltd uses. It seems to be storing some encrypted files. Connect with <code>nc 2018shell2.picoctf.com 15037</code>. Can you get us the flag?&quot; <a href="https://2018shell2.picoctf.com/static/61d78e61c2bd099775499bba7edc1d62/eleCTRic.py">Source</a></p></blockquote><h1 id="solution">Solution</h1><p>The title makes a clear reference to <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation#Counter_(CTR)">AES-CTR</a>. We can see that this mode of AES requires a unique nonce for each encrypted value to remain cryptographically secure. If we look at the problem's source code, we can see that the counter remains constant for all values. This breaks the encryption used and we are able to reveal the keystream and encrypt arbritary data.</p><pre style="background-color:#ffffff;">
<code><span style="font-weight:bold;color:#a71d5d;">class </span><span style="color:#0086b3;">AESCipher</span><span style="color:#323232;">(</span><span style="color:#0086b3;">object</span><span style="color:#323232;">):
    </span><span style="font-weight:bold;color:#a71d5d;">def </span><span style="font-weight:bold;color:#62a35c;">__init__</span><span style="color:#323232;">(self):
        self.bs </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">32
        </span><span style="color:#323232;">random </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">Random.new()
        self.key </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">random.read(</span><span style="color:#0086b3;">AES</span><span style="color:#323232;">.block_size)
        self.ctr </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">random.read(</span><span style="color:#0086b3;">AES</span><span style="color:#323232;">.block_size)

    </span><span style="font-weight:bold;color:#a71d5d;">def </span><span style="font-weight:bold;color:#323232;">encrypt</span><span style="color:#323232;">(self, raw):
        cipher </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">AES.new(self.key, </span><span style="color:#0086b3;">AES</span><span style="color:#323232;">.</span><span style="color:#0086b3;">MODE_CTR</span><span style="color:#323232;">, counter</span><span style="font-weight:bold;color:#a71d5d;">=lambda</span><span style="color:#323232;">: self.ctr)
        </span><span style="font-weight:bold;color:#a71d5d;">return </span><span style="color:#323232;">cipher.encrypt(raw).encode(</span><span style="color:#183691;">&#39;base64&#39;</span><span style="color:#323232;">).replace(</span><span style="color:#183691;">&#39;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&#39;</span><span style="color:#323232;">, </span><span style="color:#183691;">&#39;&#39;</span><span style="color:#323232;">)
</span></code></pre></div><a href="https://blog.srikavin.me/posts/picoctf-2018-electric/" class="blog-preview-continue-reading">Continue Reading</a></div></div></div></div></section><div class="disabled" id="theme-selector"><div id="dark-icon"><img alt="Switch to Dark Mode" src="/assets/dark-icon.svg"><div>Dark</div></div><div id="light-icon"><img alt="Switch to Light Mode" src="/assets/light-icon.svg"><div>Light</div></div></div><script>const ts = document.getElementById("theme-selector");
    ts.classList.remove("disabled");
    ts.onclick = () => {
        if (document.body.classList.contains("dark")) {
            document.body.classList.remove("dark");
            document.body.classList.add("light");
        } else {
            document.body.classList.remove("light");
            document.body.classList.add("dark");
        }
        localStorage.setItem("theme", document.body.classList.contains("dark") ? "dark" : "light");
    };</script><script src="/bundle.js" defer></script></body></html>