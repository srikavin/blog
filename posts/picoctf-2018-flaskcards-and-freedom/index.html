<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
<meta content="picoCTF 2018 - Flaskcards and Freedom" property="og:title"/>
<meta content="article" property="og:type"/>
<meta content="2018-10-12T21:02:44.42Z" property="og:published_time"/>
<meta content="2018-10-12T22:55:27.216Z" property="og:modified_time"/>
<meta content="Srikavin Ramkumar" property="og:author"/>
<meta content="ctf-writeups" property="og:section"/>
<meta content="picoctf18" property="og:tag"/>
<meta content="web" property="og:tag"/>
<meta content="python" property="og:tag"/>
<meta content="rce" property="og:tag"/>
<meta content="/posts/picoctf-2018-flaskcards-and-freedom/" property="og:url"/>

    <title>picoCTF 2018 - Flaskcards and Freedom - srikavin.me</title>
    <link rel="stylesheet" href="/bundle.css">
</head>

<body>
<nav>
    <div class="nav-left">
        <span>
            <a href="https://srikavin.me" class="name">Srikavin Ramkumar</a>
        </span>
        <span>
            <a href="/posts" class="nav-link">Posts</a>
        </span>
        <span>
            <a class="nav-link" href="/tags">Tags</a>
        </span>
    </div>
</nav>
<section class="section">
    <div class="container">
        

<div class="blog-container">
    


<div class="blog-header">
    <h1 class="title">
        
        picoCTF 2018 - Flaskcards and Freedom
        
    </h1>
    <div class="subtitle">
                    <span>Posted on
                        <span class="date" title="Created: 2018-10-12T21:02:44.42Z&#10;Updated: 2018-10-12T22:55:27.216Z">October 12, 2018*
                        </span>

                        in ctf-writeups
                        
                </span>
    </div>
    <div class="tags">
        
        
        <a href="&#x2F;tags&#x2F;picoctf18&#x2F;"><span class="tag minimal interactive">picoctf18</span></a>
        
        
        <a href="&#x2F;tags&#x2F;web&#x2F;"><span class="tag minimal interactive">web</span></a>
        
        
        <a href="&#x2F;tags&#x2F;python&#x2F;"><span class="tag minimal interactive">python</span></a>
        
        
        <a href="&#x2F;tags&#x2F;rce&#x2F;"><span class="tag minimal interactive">rce</span></a>
        
    </div>
</div>


<div class="blog-content light">
    <div class="blog-scrollspy">
        <h1 class="scrollspy-label">Table of Contents</h1>
        <ul>
            
            <li>
                <a data-target="problem" href="#problem">Problem</a>
                
            </li>
            
            <li>
                <a data-target="solution" href="#solution">Solution</a>
                
            </li>
            
        </ul>
    </div>

    <h1 id="problem">Problem</h1>
<blockquote>
<p>&quot;There seem to be a few more files stored on the flash card server but we can't login. Can you?&quot;</p>
</blockquote>
<h1 id="solution">Solution</h1>
<p>The site appears to be the same as the previous flaskcard challenges <code>Flaskcards Skeleton Key</code> and  <code>Flaskcards.</code></p>
<p>When we create an account, we are presented with the following screen:
<img src="/posts/picoctf-2018-flaskcards-and-freedom/5bc10c83f1882e545d7f430a.png" alt="" /></p>
<p>We can try server side injection. If we type in <code>{{1+1}}</code>, the webpage displays <code>2</code>.  Any values in double brackets is being executed on the server. After trying to find hidden variables, such as <code>config</code>, <code>flag</code>, etc; I decided to look for a remote code execution vulnerability. </p>
<span id="continue-reading"></span>
<p><img src="/posts/picoctf-2018-flaskcards-and-freedom/5bc114c3b7c5001b74f57e35.png" alt="" /></p>
<p>We can list all of the loaded classes by calling <code>__subclasses__</code> on the base object class. To do this, I used the <code>mro</code> method, which lists all of the superclasses, including <code>object</code>. Calling this on a string gives easy access to the base object class.</p>
<p><img src="/posts/picoctf-2018-flaskcards-and-freedom/5bc114f6b7c5001b74f57e37.png" alt="" /></p>
<p>The object class is index <code>1</code> when calling <code>''.__class__.mro()</code>. So we can access the subclasses of object by injecting <code>''.__class__.mro()[1].__subclasses__()</code>. This results in a lot of output.</p>
<p><img src="/posts/picoctf-2018-flaskcards-and-freedom/5bc11620b7c5001b74f57e39.png" alt="" /></p>
<p>After cleaning up the output, I found that <code>&lt;class 'subprocess.Popen'&gt;</code> was index 48.</p>
<p>From there it is possible to run <code>ls</code> with <code>{{''.__class__.mro()[1].__subclasses__()[48](['ls'], stdout=-1).communicate()}}</code>. Running with <code>-1</code> results in the output being returned as a tuple:</p>
<p><img src="/posts/picoctf-2018-flaskcards-and-freedom/5bc11752b7c5001b74f57e3c.png" alt="" /></p>
<p>Calling <code>ls</code> lists the files in the directory. All that's left is to call <code>cat flag</code> with <code>{{''.__class__.mro()[1].__subclasses__()[380](['cat', 'flag'], stdout=-1).communicate()}}</code>:</p>
<p><img src="/posts/picoctf-2018-flaskcards-and-freedom/5bc117aab7c5001b74f57e3e.png" alt="" /></p>

</div>


</div>

<script src="https://utteranc.es/client.js"
        repo="srikavin/blog"
        issue-term="url"
        label="ðŸ’¬comments"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

    </div>
</section>

<script src="/bundle.js"></script>
 

</body>

</html>
