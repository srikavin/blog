<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="nactf 2019 - Dr. J&#x27;s Group Test Randomizer #2: BBOB" property="og:title"><meta content="article" property="og:type"><meta content="2019-09-22T17:48:52.836Z" property="og:published_time"><meta content="2020-12-27" property="og:modified_time"><meta content="Srikavin Ramkumar" property="og:author" name="author"><meta content="ctf-writeups" property="og:section"><meta content="nactf2019" property="og:tag"><meta content="cryptography" property="og:tag"><meta content="z3" property="og:tag"><meta content="nactf2019, cryptography, z3" property="keywords"><meta content="https://blog.srikavin.me/posts/nactf-2019-dr-j-s-group-test-randomizer-2-bbob/" property="og:url"><title>nactf 2019 - Dr. J&#x27;s Group Test Randomizer #2: BBOB - srikavin.me</title><link href="/favicon.png" rel="icon"><link href="/bundle.css" rel="stylesheet"><script src="https://www.googletagmanager.com/gtag/js?id=G-X8ZVFPQ0CK" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-X8ZVFPQ0CK');</script></head><body><nav><div class="nav-left"><span><a href="https://srikavin.me" class="name">Srikavin Ramkumar</a> </span><span><a href="/posts" class="nav-link">Posts</a> </span><span><a href="/tags" class="nav-link">Tags</a></span></div><div class="nav-right"><a href="https://github.com/srikavin"><img alt="Github" height="24px" src="/gh-logo.png" width="24px"></a></div></nav><section class="section"><div class="container"><div class="page-container"><div class="blog-header"><h1 class="title">nactf 2019 - Dr. J&#x27;s Group Test Randomizer #2: BBOB</h1><div class="subtitle"><span>Posted on <span class="date" title="Created: 2019-09-22T17:48:52.836Z&#10;Updated: 2020-12-27">September 22, 2019* </span>in ctf-writeups</span></div><div class="tags"><a href="https:&#x2F;&#x2F;blog.srikavin.me&#x2F;tags&#x2F;nactf2019&#x2F;"><span class="interactive minimal tag">nactf2019</span></a> <a href="https:&#x2F;&#x2F;blog.srikavin.me&#x2F;tags&#x2F;cryptography&#x2F;"><span class="interactive minimal tag">cryptography</span></a> <a href="https:&#x2F;&#x2F;blog.srikavin.me&#x2F;tags&#x2F;z3&#x2F;"><span class="interactive minimal tag">z3</span></a></div></div><div class="blog-content light"><div class="blog-scrollspy"><h1 class="scrollspy-label">Table of Contents</h1><ul><li><a href="#challenge" data-target="challenge">Challenge</a></li><li><a href="#solution" data-target="solution">Solution</a><ul><li><a href="#full-script" data-target="full-script">Full Script</a></li></ul></li></ul></div><h1 id="challenge">Challenge</h1><blockquote><p>This is it. The last group test of the year. Dr. J patched his prng again so numbers won't repeat, so I guess Leaf won't get to know the group test pairs ahead of time... oh WEYL. Who knew middle square could make such a good prng?</p><p><code>nc shell.2019.nactf.com 31382</code></p></blockquote><p>We're also given the source of the running application:</p><pre style="background-color:#ffffff;">
<code><span style="font-weight:bold;color:#a71d5d;">#include </span><span style="color:#183691;">&lt;stdio.h&gt;
</span><span style="font-weight:bold;color:#a71d5d;">#include </span><span style="color:#183691;">&lt;stdint.h&gt;
</span><span style="font-weight:bold;color:#a71d5d;">#include </span><span style="color:#183691;">&lt;sodium.h&gt;
</span><span style="font-weight:bold;color:#a71d5d;">#include </span><span style="color:#183691;">&lt;stdbool.h&gt;
</span><span style="font-weight:bold;color:#a71d5d;">#include </span><span style="color:#183691;">&lt;string.h&gt;
</span><span style="font-weight:bold;color:#a71d5d;">#define </span><span style="color:#323232;">NUM_CORRECT </span><span style="color:#0086b3;">10

uint64_t</span><span style="color:#323232;"> x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">0</span><span style="color:#323232;">, w </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">0</span><span style="color:#323232;">, s </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">0xb5ad4eceda1ce2a9</span><span style="color:#323232;">;

</span><span style="color:#0086b3;">uint32_t </span><span style="font-weight:bold;color:#795da3;">nextRand</span><span style="color:#323232;">() {
  w </span><span style="font-weight:bold;color:#a71d5d;">+=</span><span style="color:#323232;"> s;
  x </span><span style="font-weight:bold;color:#a71d5d;">=</span><span style="color:#323232;"> x</span><span style="font-weight:bold;color:#a71d5d;">*</span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">+</span><span style="color:#323232;"> w;
  x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">(x</span><span style="font-weight:bold;color:#a71d5d;">&gt;&gt;</span><span style="color:#0086b3;">32</span><span style="color:#323232;">) </span><span style="font-weight:bold;color:#a71d5d;">| </span><span style="color:#323232;">(x</span><span style="font-weight:bold;color:#a71d5d;">&lt;&lt;</span><span style="color:#0086b3;">32</span><span style="color:#323232;">);
  </span><span style="font-weight:bold;color:#a71d5d;">return</span><span style="color:#323232;"> x </span><span style="font-weight:bold;color:#a71d5d;">% </span><span style="color:#323232;">(</span><span style="color:#0086b3;">1</span><span style="font-weight:bold;color:#a71d5d;">UL&lt;&lt;</span><span style="color:#0086b3;">32</span><span style="color:#323232;">);
}

</span><span style="font-weight:bold;color:#a71d5d;">void </span><span style="font-weight:bold;color:#795da3;">init_seed</span><span style="color:#323232;">() {
  </span><span style="color:#0086b3;">uint64_t</span><span style="color:#323232;"> r1 </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">(</span><span style="color:#0086b3;">uint64_t</span><span style="color:#323232;">) randombytes_random();
  </span><span style="color:#0086b3;">uint64_t</span><span style="color:#323232;"> r2 </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">(</span><span style="color:#0086b3;">uint64_t</span><span style="color:#323232;">) randombytes_random();
  x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">(r1 </span><span style="font-weight:bold;color:#a71d5d;">&lt;&lt; </span><span style="color:#0086b3;">32</span><span style="color:#323232;">) </span><span style="font-weight:bold;color:#a71d5d;">+</span><span style="color:#323232;"> r2;
  r1 </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">(</span><span style="color:#0086b3;">uint64_t</span><span style="color:#323232;">) randombytes_random();
  r2 </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">(</span><span style="color:#0086b3;">uint64_t</span><span style="color:#323232;">) randombytes_random();
  w </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">(r1 </span><span style="font-weight:bold;color:#a71d5d;">&lt;&lt; </span><span style="color:#0086b3;">32</span><span style="color:#323232;">) </span><span style="font-weight:bold;color:#a71d5d;">+</span><span style="color:#323232;"> r2;
}

</span><span style="font-weight:bold;color:#a71d5d;">void </span><span style="font-weight:bold;color:#795da3;">print_flag</span><span style="color:#323232;">() {
  FILE </span><span style="font-weight:bold;color:#a71d5d;">*</span><span style="color:#323232;">f </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#62a35c;">fopen</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;flag.txt&quot;</span><span style="color:#323232;">, </span><span style="color:#183691;">&quot;r&quot;</span><span style="color:#323232;">);
  </span><span style="font-weight:bold;color:#a71d5d;">char</span><span style="color:#323232;"> flag[</span><span style="color:#0086b3;">100</span><span style="color:#323232;">];
  </span><span style="color:#62a35c;">fgets</span><span style="color:#323232;">(flag, </span><span style="font-weight:bold;color:#a71d5d;">sizeof</span><span style="color:#323232;">(flag), f);
  </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">%s\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">, flag);
  </span><span style="color:#62a35c;">fflush</span><span style="color:#323232;">( stdout );
  </span><span style="font-weight:bold;color:#a71d5d;">return</span><span style="color:#323232;">;
}

</span><span style="font-weight:bold;color:#a71d5d;">const char *</span><span style="color:#323232;">messages[NUM_CORRECT] </span><span style="font-weight:bold;color:#a71d5d;">=
</span><span style="color:#323232;">{ </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">Hmm... lucky guess...</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">,
  </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">Wow, that was coincidental!</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">,
  </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">What? How did you guess that?</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">,
  </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">That&#39;s right, but you won&#39;t be able to guess right again!</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&gt; &quot;</span><span style="color:#323232;">,
  </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">Strangely, that&#39;s correct...</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;
</span><span style="color:#323232;">};

</span><span style="font-weight:bold;color:#a71d5d;">int </span><span style="font-weight:bold;color:#795da3;">main</span><span style="color:#323232;">() {
  </span><span style="color:#62a35c;">setvbuf</span><span style="color:#323232;">(stdout, </span><span style="color:#0086b3;">NULL</span><span style="color:#323232;">, _IONBF, </span><span style="color:#0086b3;">0</span><span style="color:#323232;">);
  init_seed();
  </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">Welcome to Dr. J&#39;s Random Number Generator v3! We have received reports of &quot;
  &quot;a vulnerability involving repetition of output. This vulnerability has since been patched, &quot;
  &quot;and Dr. J&#39;s RNG is now 100</span><span style="color:#0086b3;">%%</span><span style="color:#183691;"> secure. </span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;
  &quot;[r] Print a new random number </span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;
  &quot;[g] Guess the next ten random numbers and receive the flag! </span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;
  &quot;[q] Quit </span><span style="color:#0086b3;">\n\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">);
  </span><span style="font-weight:bold;color:#a71d5d;">char</span><span style="color:#323232;"> line[</span><span style="color:#0086b3;">100</span><span style="color:#323232;">];
  </span><span style="font-weight:bold;color:#a71d5d;">while </span><span style="color:#323232;">(</span><span style="color:#0086b3;">true</span><span style="color:#323232;">) {
    </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;&gt; &quot;</span><span style="color:#323232;">);
    </span><span style="color:#62a35c;">fgets </span><span style="color:#323232;">(line, </span><span style="font-weight:bold;color:#a71d5d;">sizeof</span><span style="color:#323232;">(line), stdin);
    line[</span><span style="color:#62a35c;">strcspn</span><span style="color:#323232;">(line, </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">)] </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">0</span><span style="color:#323232;">;

    </span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#323232;">(</span><span style="font-weight:bold;color:#a71d5d;">!</span><span style="color:#62a35c;">strcmp</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;r&quot;</span><span style="color:#323232;">, line)) {
      </span><span style="color:#0086b3;">uint64_t</span><span style="color:#323232;"> r </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">nextRand();
      </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">%lu\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">, r);
    }
    </span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#323232;">(</span><span style="font-weight:bold;color:#a71d5d;">!</span><span style="color:#62a35c;">strcmp</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;g&quot;</span><span style="color:#323232;">, line)) {
      </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">Guess the next ten random numbers for a flag! &quot;
      &quot;The chance of guessing all ten numbers correctly is 1/(2*10^96). I hope you&#39;re lucky! &quot;
      &quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">Enter Guess 1:</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&gt; &quot;</span><span style="color:#323232;">);

      </span><span style="font-weight:bold;color:#a71d5d;">for </span><span style="color:#323232;">(</span><span style="font-weight:bold;color:#a71d5d;">int</span><span style="color:#323232;"> i </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">0</span><span style="color:#323232;">; i </span><span style="font-weight:bold;color:#a71d5d;">&lt;</span><span style="color:#323232;"> NUM_CORRECT; i</span><span style="font-weight:bold;color:#a71d5d;">++</span><span style="color:#323232;">) {
        </span><span style="color:#0086b3;">uint64_t</span><span style="color:#323232;"> guess </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#0086b3;">0</span><span style="color:#323232;">;
        </span><span style="color:#62a35c;">fgets </span><span style="color:#323232;">(line, </span><span style="font-weight:bold;color:#a71d5d;">sizeof</span><span style="color:#323232;">(line), stdin);
        </span><span style="color:#62a35c;">sscanf</span><span style="color:#323232;">(line, </span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">%lu</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">, </span><span style="font-weight:bold;color:#a71d5d;">&amp;</span><span style="color:#323232;">guess);
        </span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#323232;">(guess </span><span style="font-weight:bold;color:#a71d5d;">== </span><span style="color:#323232;">nextRand()) {
          </span><span style="font-weight:bold;color:#a71d5d;">int</span><span style="color:#323232;"> m </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">randombytes_uniform(</span><span style="color:#0086b3;">5</span><span style="color:#323232;">);
          </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">%s</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">, messages[m]);
          </span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#323232;">(i </span><span style="font-weight:bold;color:#a71d5d;">&lt;</span><span style="color:#323232;"> NUM_CORRECT</span><span style="font-weight:bold;color:#a71d5d;">-</span><span style="color:#0086b3;">1</span><span style="color:#323232;">) {
            </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;Enter Guess </span><span style="color:#0086b3;">%d</span><span style="color:#183691;">:</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&gt; &quot;</span><span style="color:#323232;">, i</span><span style="font-weight:bold;color:#a71d5d;">+</span><span style="color:#0086b3;">2</span><span style="color:#323232;">);
          }
          </span><span style="font-weight:bold;color:#a71d5d;">else </span><span style="color:#323232;">{
            </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;What sorcery is this? That&#39;s impossible! I guess you deserve this flag:</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">);
            print_flag();
            </span><span style="font-weight:bold;color:#a71d5d;">break</span><span style="color:#323232;">;
          }
        }
        </span><span style="font-weight:bold;color:#a71d5d;">else </span><span style="color:#323232;">{
          </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;That&#39;s incorrect. Get out of here!</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">);
          </span><span style="font-weight:bold;color:#a71d5d;">break</span><span style="color:#323232;">;
        }
      }
      </span><span style="font-weight:bold;color:#a71d5d;">break</span><span style="color:#323232;">;
    }
    </span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#323232;">(</span><span style="font-weight:bold;color:#a71d5d;">!</span><span style="color:#62a35c;">strcmp</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;q&quot;</span><span style="color:#323232;">, line)) {
      </span><span style="color:#62a35c;">printf</span><span style="color:#323232;">(</span><span style="color:#183691;">&quot;</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">Goodbye!</span><span style="color:#0086b3;">\n</span><span style="color:#183691;">&quot;</span><span style="color:#323232;">);
      </span><span style="font-weight:bold;color:#a71d5d;">break</span><span style="color:#323232;">;
    }
  }
  </span><span style="font-weight:bold;color:#a71d5d;">return </span><span style="color:#0086b3;">0</span><span style="color:#323232;">;
}
</span></code></pre><span id="continue-reading"></span><h1 id="solution">Solution</h1><p>This is solvable mathematically as the lower 32 bits of <code>x</code> are given after each iteration. However, I chose to use <code>z3</code> instead of solving this by hand.</p><p>We only need to implement the <code>nextRand()</code> function in python because the internal state of the PRNG is only changed here:</p><pre style="background-color:#ffffff;">
<code><span style="color:#323232;">so </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">Solver()

x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">BitVec(</span><span style="color:#183691;">&#39;x&#39;</span><span style="color:#323232;">, </span><span style="color:#0086b3;">64</span><span style="color:#323232;">)
w </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">BitVec(</span><span style="color:#183691;">&#39;w&#39;</span><span style="color:#323232;">, </span><span style="color:#0086b3;">64</span><span style="color:#323232;">)


</span><span style="font-weight:bold;color:#a71d5d;">def </span><span style="font-weight:bold;color:#323232;">nextRand</span><span style="color:#323232;">():
    </span><span style="font-weight:bold;color:#a71d5d;">global </span><span style="color:#323232;">x, w

    w </span><span style="font-weight:bold;color:#a71d5d;">+= </span><span style="color:#0086b3;">0xb5ad4eceda1ce2a9

    </span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">* </span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">+ </span><span style="color:#323232;">w
    x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">LShR(x, </span><span style="color:#0086b3;">32</span><span style="color:#323232;">) </span><span style="font-weight:bold;color:#a71d5d;">| </span><span style="color:#323232;">(x </span><span style="font-weight:bold;color:#a71d5d;">&lt;&lt; </span><span style="color:#0086b3;">32</span><span style="color:#323232;">)  </span><span style="font-style:italic;color:#969896;"># x = b, a
    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span style="color:#323232;">Extract(</span><span style="color:#0086b3;">31</span><span style="color:#323232;">, </span><span style="color:#0086b3;">0</span><span style="color:#323232;">, URem(x, </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">&lt;&lt; </span><span style="color:#0086b3;">32</span><span style="color:#323232;">))
</span></code></pre><p>An important thing to note with <code>z3</code> is the python right shift operator (<code>&gt;&gt;</code>) acts as if the bit vector is signed. To treat the bit vector as unsigned, you need to use <code>LShR</code>. After implementing this function, we simply need to constrain the output of the function with <code>z3</code>:</p><pre style="background-color:#ffffff;">
<code><span style="color:#323232;">rand </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[
    </span><span style="color:#0086b3;">3482268774</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">3733492975</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">1914513130</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">577823218</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">3863315458</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">820480830</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">4172394928</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">1278770144</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">3099743734</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">3093365285
</span><span style="color:#323232;">]

generated </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[BitVecVal(x, </span><span style="color:#0086b3;">32</span><span style="color:#323232;">) </span><span style="font-weight:bold;color:#a71d5d;">for </span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">rand]
</span><span style="font-weight:bold;color:#a71d5d;">for </span><span style="color:#323232;">k </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">generated:
    so.add(nextRand() </span><span style="font-weight:bold;color:#a71d5d;">== </span><span style="color:#323232;">k)
</span></code></pre><p>And finally, we can print out the produced model:</p><pre style="background-color:#ffffff;">
<code><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#323232;">so.check() </span><span style="font-weight:bold;color:#a71d5d;">== </span><span style="color:#323232;">sat:
    </span><span style="color:#62a35c;">print</span><span style="color:#323232;">(so.model())
</span><span style="font-weight:bold;color:#a71d5d;">else</span><span style="color:#323232;">:
    </span><span style="color:#62a35c;">print</span><span style="color:#323232;">(</span><span style="color:#183691;">&#39;unsat&#39;</span><span style="color:#323232;">)
</span></code></pre><p>In testing, I found that this would not return the same initial <code>x</code> and <code>w</code> values, but the values produced by the PRNG were correct for at least the next 20 values. After we find the values of <code>x</code> and <code>w</code>, we can use those in the given source in the <code>init_seed()</code> function to get the next 10 numbers.</p><h3 id="full-script">Full Script</h3><pre style="background-color:#ffffff;">
<code><span style="color:#323232;">
</span><span style="font-weight:bold;color:#a71d5d;">from </span><span style="color:#323232;">z3 </span><span style="font-weight:bold;color:#a71d5d;">import </span><span style="color:#0086b3;">*

</span><span style="color:#323232;">so </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">Solver()

x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">BitVec(</span><span style="color:#183691;">&#39;x&#39;</span><span style="color:#323232;">, </span><span style="color:#0086b3;">64</span><span style="color:#323232;">)
w </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">BitVec(</span><span style="color:#183691;">&#39;w&#39;</span><span style="color:#323232;">, </span><span style="color:#0086b3;">64</span><span style="color:#323232;">)


</span><span style="font-weight:bold;color:#a71d5d;">def </span><span style="font-weight:bold;color:#323232;">nextRand</span><span style="color:#323232;">():
    </span><span style="font-weight:bold;color:#a71d5d;">global </span><span style="color:#323232;">x, w

    w </span><span style="font-weight:bold;color:#a71d5d;">+= </span><span style="color:#0086b3;">0xb5ad4eceda1ce2a9

    </span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">* </span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">+ </span><span style="color:#323232;">w
    x </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">LShR(x, </span><span style="color:#0086b3;">32</span><span style="color:#323232;">) </span><span style="font-weight:bold;color:#a71d5d;">| </span><span style="color:#323232;">(x </span><span style="font-weight:bold;color:#a71d5d;">&lt;&lt; </span><span style="color:#0086b3;">32</span><span style="color:#323232;">)  </span><span style="font-style:italic;color:#969896;"># x = b, a
    </span><span style="font-weight:bold;color:#a71d5d;">return </span><span style="color:#323232;">Extract(</span><span style="color:#0086b3;">31</span><span style="color:#323232;">, </span><span style="color:#0086b3;">0</span><span style="color:#323232;">, URem(x, </span><span style="color:#0086b3;">1 </span><span style="font-weight:bold;color:#a71d5d;">&lt;&lt; </span><span style="color:#0086b3;">32</span><span style="color:#323232;">))


rand </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[
    </span><span style="color:#0086b3;">3482268774</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">3733492975</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">1914513130</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">577823218</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">3863315458</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">820480830</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">4172394928</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">1278770144</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">3099743734</span><span style="color:#323232;">,
    </span><span style="color:#0086b3;">3093365285
</span><span style="color:#323232;">]

generated </span><span style="font-weight:bold;color:#a71d5d;">= </span><span style="color:#323232;">[BitVecVal(x, </span><span style="color:#0086b3;">32</span><span style="color:#323232;">) </span><span style="font-weight:bold;color:#a71d5d;">for </span><span style="color:#323232;">x </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">rand]

</span><span style="font-weight:bold;color:#a71d5d;">for </span><span style="color:#323232;">k </span><span style="font-weight:bold;color:#a71d5d;">in </span><span style="color:#323232;">generated:
    so.add(nextRand() </span><span style="font-weight:bold;color:#a71d5d;">== </span><span style="color:#323232;">k)

</span><span style="font-weight:bold;color:#a71d5d;">if </span><span style="color:#323232;">so.check() </span><span style="font-weight:bold;color:#a71d5d;">== </span><span style="color:#323232;">sat:
    </span><span style="color:#62a35c;">print</span><span style="color:#323232;">(so.model())
</span><span style="font-weight:bold;color:#a71d5d;">else</span><span style="color:#323232;">:
    </span><span style="color:#62a35c;">print</span><span style="color:#323232;">(</span><span style="color:#183691;">&#39;unsat&#39;</span><span style="color:#323232;">)
</span></code></pre></div></div><script src="https://utteranc.es/client.js" async crossorigin="anonymous" issue-term="url" label="💬comments" repo="srikavin/blog" theme="github-light"></script></div></section><script src="/bundle.js"></script></body></html>